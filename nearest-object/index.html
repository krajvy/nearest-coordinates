<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Nearest Object</title>
		<meta name="description" content="Find nearest object by coordinates">
		<meta name="author" content="Jan 'krajvy' Krivohlavek">
		<script>
			/* Global object for working with all coordinates */
			var NearestObject = {
				config: {
					idElOutput: 'data_out',
					idElInputCoord: 'coord_in'
				},
				coordIn: null,
				testData: [
					{ 'lat': 50.083333, 'lon': 14.416667, 'desc': 'Prague' },
					{ 'lat': 50.45, 'lon': 30.523333, 'desc': 'Kiev' },
					{ 'lat': 52.366667, 'lon': 4.9, 'desc': 'Amsterdam' },
					{ 'lat': 59.329444, 'lon': 18.068611, 'desc': 'Stockholm' },
					{ 'lat': 41.326, 'lon': 19.816, 'desc': 'Tirana' },
					{ 'lat': 53.347778, 'lon': -6.259722, 'desc': 'Dublin' },
					{ 'lat': -34.603333, 'lon': -58.381667, 'desc': 'Buenos Aires' },
					{ 'lat': -33.865, 'lon': 151.209444, 'desc': 'Sydney' },
					{ 'lat': 45.416667, 'lon': -75.683333, 'desc': 'Ottawa' },
					{ 'lat': 43.133333, 'lon': 131.9, 'desc': 'Vladivostok' },
					{ 'lat': 0.016667, 'lon': 37.066667, 'desc': 'Nanyuki' },
					{ 'lat': 65.584167, 'lon': -170.988889, 'desc': 'Lavrentiya' },
					{ 'lat': 0, 'lon': 109.333333, 'desc': 'Pontianak' },
					{ 'lat': 0, 'lon': 0, 'desc': 'Middleearth' },
					{ 'lat': 90, 'lon': 0, 'desc': 'North Pole' },
					{ 'lat': -90, 'lon': 0, 'desc': 'South Pole' },
					{ 'lat': -64.497, 'lon': 137.684, 'desc': 'South Magnetic Pole' },
					{ 'lat': 83.95, 'lon': -120.72, 'desc': 'North Magnetic Pole' }
				],
				testInputCoordinates: { 'lat': 49.8117486, 'lon': 13.9886431, 'desc': 'Plesivec (test start point)'},
				/**
				* Process nearest search
				* @param int lat latitude coordinate for searching start point
				* @param int lon longitude coordinate for searching start point
				* @return object sorted output data with nearest points
				*/
				findNearest: function(lat, lon) {
					var outputData = [];
					for(var i in this.testData) {
						outputData.push(this.testData[i]);
					}
					return outputData;
				},
				/**
				* Format output coordinates
				* @param int lat latitude coordinate
				* @param int lon longitude coordinate
				* @return string formatted coordinates
				*/
				getOutputCoords: function(lat, lon) {
					return lat + ',' + lon;
				},
				/**
				* Output data to table
				* @param object outputData data for output to table
				* @return bool true if success, false elsewhere
				*/
				renderTable: function(outputData) {
					var outputEl = document.getElementById(this.config.idElOutput);
					if(!outputEl) {
						return false;
					}
					
					// emtpty workspace
					outputEl.innerHTML = '';

					// fill output with formatted output
					for(var i in outputData) {
						var _tr = document.createElement('tr');
						
						var coord = document.createElement('td');
						coord.textContent = this.getOutputCoords(outputData[i].lat, outputData[i].lon);
						_tr.appendChild(coord);
						
						var dist = document.createElement('td');
						dist.textContent = '-';
						_tr.appendChild(dist);
						
						var orient = document.createElement('td');
						orient.textContent = '?';
						_tr.appendChild(orient);
						
						var desc = document.createElement('td');
						desc.textContent = outputData[i].desc;
						_tr.appendChild(desc);
						
						// and finally append it to output element
						outputEl.appendChild(_tr);
					}
					return true;
				},
				/**
				* Read data from form and find nearest objects
				*/
				process: function() {
					// TODO: better handling input
					//this.coordIn = document.getElementById(this.config.idElInputCoord).value;
					// TODO: read lat and lon from input
					var lat = this.testInputCoordinates.lat;
					var lon = this.testInputCoordinates.lon;
					var nearest = this.findNearest(lat, lon);
					this.renderTable(nearest);
					// TODO: return false is not quite correct...will use preventDefault instead in future
					return false;
				}
			};
		</script>
		<style type="text/css">
			table {
				border-collapse: collapse;
				border-spacing: 0px;
			}
			table, th, td {
				padding: 5px;
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
		<form id="data_in" action="#" onsubmit="return NearestObject.process();" method="post">
			<fieldset>
				<legend>Input</legend>
				<div>
					<label for="coord_in">Coordinates:</label>
					<input type="text" name="coordinates_in" id="coord_in" />
				</div>
				<div>
					<input type="submit" id="submit" value="Process" />
				</div>
			</fieldset>
		</form>
		<table>
			<thead>
				<tr>
					<th>Coordinates</th>
					<th>Distance</th>
					<th>Orientation</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody id="data_out">
			</tbody>
		</table>
	</body>
</html>
